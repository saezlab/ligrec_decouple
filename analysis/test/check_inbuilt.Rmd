---
title: "check_inbuilt"
author: "Daniel Dimitrov"
date: "6/7/2021"
output: html_document
---

```{r setup, include=FALSE, echo=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE)
require(intercell)
require(tidyverse)
require(magrittr)

omni_resources <- compile_ligrec(lr_pipeline = TRUE)


#' Helper Function to get uniques values of a given column
#' @param left_res e.g. OmniPath version of a Resource
#' @param right_res e.g. Inbuilt version of a Resource
#' @param column name of the column to check
get_uniques <- function(left_res, right_res, column){
    jacc <- length(intersect(left_res[[column]], right_res[[column]]))/
        length(union(left_res[[column]], right_res[[column]]))
    message(
        str_glue("Jacc Index: {round(jacc, digits = 3)}")
    )

    left_res %>%
        select(!!column) %>%
        filter(!(.data[[column]] %in% right_res[[column]])) %>%
        distinct()
}
```



### I) Check CellChat
##### inbuilt Resource CellChatDB
```{r cellchat}

cc_inbuilt <- CellChat::CellChatDB.human %>%
    pluck("interaction") %>%
    select(interaction_name, ligand, receptor)


cc_omnipath <- cellchat_formatDB(CellChat::CellChatDB.human,
                                 omni_resources$CellChatDB,
                                 exclude_anns = c()) %>%
    pluck("interaction") %>%
    select(interaction_name, ligand, receptor)

# 1,939 interactions for Original DB, 2,551 for OmniPath
cc_omnipath %>% glimpse()
cc_inbuilt %>% glimpse()
```


#### 1) Unique Interactions
```{r cellchat_interactions}
get_uniques(cc_omnipath, cc_inbuilt, "interaction_name") %>%
  rmarkdown::paged_table() # Unique to OmniPath

get_uniques(cc_inbuilt, cc_omnipath, "interaction_name") %>%
  rmarkdown::paged_table() # Unique to Inbuilt
```

#### 2) Unique Ligands
```{r cellchat_ligands}
get_uniques(cc_omnipath, cc_inbuilt, "ligand") %>%
  rmarkdown::paged_table()  # Unique to OmniPath

get_uniques(cc_inbuilt, cc_omnipath, "ligand") %>%
  rmarkdown::paged_table() # Unique to Inbuilt
```

#### 3) Unique Receptors
```{r cellchat_receptors}
get_uniques(cc_omnipath, cc_inbuilt, "receptor") %>%
  rmarkdown::paged_table()  # Unique to OmniPath

get_uniques(cc_inbuilt, cc_omnipath, "receptor") %>%
  rmarkdown::paged_table() # Unique to Inbuilt
```


### II) Check SingleCellSignalR
##### Inbuilt Resource LRdb
```{r sca}
lrdb_omni <- omni_resources$LRdb %>%
    sca_formatDB() %>%
    unite(ligand, receptor, col = "interaction", remove = FALSE)


load("input/LRdb.rda")
lrdb_inbuilt <- LRdb %>%
    unite(ligand, receptor, col = "interaction", remove = FALSE)

lrdb_omni %>% glimpse()
lrdb_inbuilt %>% glimpse()
```



#### 1) Unique Interactions
```{r sca_interactions}
get_uniques(lrdb_omni, lrdb_inbuilt, "interaction")  %>%
  rmarkdown::paged_table() # Unique to OmniPath

get_uniques(lrdb_inbuilt, lrdb_omni, "interaction")  %>%
  rmarkdown::paged_table() # Unique to Inbuilt
```
#### 2) Unique Ligands
```{r sca_ligands}
get_uniques(lrdb_omni, lrdb_inbuilt, "ligand") %>%
  rmarkdown::paged_table()  # Unique to OmniPath

get_uniques(lrdb_inbuilt, lrdb_omni, "ligand") %>%
  rmarkdown::paged_table() # Unique to Inbuilt
```

#### 3) Unique Receptors
```{r sca_receptors}
get_uniques(lrdb_omni, lrdb_inbuilt, "receptor") %>%
  rmarkdown::paged_table() # Unique to OmniPath

get_uniques(lrdb_inbuilt, lrdb_omni, "receptor") %>%
  rmarkdown::paged_table() # Unique to Inbuilt
```


### III) Check iTALK
##### inbuilt Resource iTALK
```{r italk}
italk_omni <- omni_resources$iTALK %>%
    italk_formatDB()

italk_inbuilt <- iTALK::database

# Glimpse Both
italk_omni %>% glimpse()
italk_inbuilt %>% glimpse()
```

#### 1) Unique Interactions
```{r italk_interactions}
get_uniques(italk_omni, italk_inbuilt, "Pair.Name") %>%
  rmarkdown::paged_table() # Unique to OmniPath

get_uniques(italk_inbuilt, italk_omni, "Pair.Name") %>%
  rmarkdown::paged_table() # Unique to Inbuilt
```

#### 2) Unique Ligands
```{r italk_ligands}
get_uniques(italk_omni, italk_inbuilt, "Ligand.ApprovedSymbol") %>%
  rmarkdown::paged_table() # Unique to OmniPath

get_uniques(italk_inbuilt, italk_omni, "Ligand.ApprovedSymbol") %>%
  rmarkdown::paged_table() # Unique to Inbuilt
```


# 3) Unique Receptors
```{r italk_receptors}
get_uniques(italk_omni, italk_inbuilt, "Receptor.ApprovedSymbol") %>%
  rmarkdown::paged_table() # Unique to OmniPath
get_uniques(italk_inbuilt, italk_omni, "Receptor.ApprovedSymbol") %>%
  rmarkdown::paged_table()# Unique to Inbuilt
```


### IV) Connectome
##### Inbuilt Resource is FANTOM5 (aka Ramilowski)
```{r conn}
conn_omni <- omni_resources$Ramilowski2015 %>%
    conn_formatDB() %>%
    unite(source_genesymbol, target_genesymbol,
          col = "Pair.Name", remove = FALSE) %>%
    rename("Ligand.ApprovedSymbol" = source_genesymbol,
           "Receptor.ApprovedSymbol" = target_genesymbol)

conn_inbuilt <- Connectome::ncomms8866_human  %>%
            filter(Pair.Evidence == "literature supported")

# Glimpse Both
conn_omni %>% glimpse()
conn_inbuilt %>% glimpse()
```

```{r conn_interactions}
#### 1) Unique Interactions
get_uniques(conn_omni, conn_inbuilt, "Pair.Name") %>%
  rmarkdown::paged_table() # Unique to OmniPath

get_uniques(conn_inbuilt, conn_omni, "Pair.Name") %>%
  rmarkdown::paged_table() # Unique to Inbuilt
```

#### 2) Unique Ligands
```{r conn_ligands}
get_uniques(conn_omni, conn_inbuilt, "Ligand.ApprovedSymbol") %>%
  rmarkdown::paged_table() # Unique to OmniPath

get_uniques(conn_inbuilt, conn_omni, "Ligand.ApprovedSymbol") %>%
  rmarkdown::paged_table() # Unique to Inbuilt
```

#### 3) Unique Receptors
```{r conn_receptors}
get_uniques(conn_omni, conn_inbuilt, "Receptor.ApprovedSymbol") %>%
  rmarkdown::paged_table() # Unique to OmniPath

get_uniques(conn_inbuilt, conn_omni, "Receptor.ApprovedSymbol") %>%
  rmarkdown::paged_table() # Unique to Inbuilt
```


### V) NATMI
##### Inbuilt Resource is ConnectomeDB (aka Ramilowski2015 follow up)

```{r natmi}
natmi_omni <- read.csv("~/Repos/NATMI/lrdbs/connectomeDB2020.csv") %>%
    unite(Ligand.gene.symbol, Receptor.gene.symbol,
          col = "Pair.Name", remove = FALSE)

natmi_inbuilt <- read.csv("~/Repos/NATMI/lrdbs/lrc2p.csv") %>%
    unite(Ligand.gene.symbol, Receptor.gene.symbol,
          col = "Pair.Name", remove = FALSE)

# Glimpse Both
natmi_omni %>% glimpse()
natmi_inbuilt %>% glimpse()
```

```{r natmi_interactions}
#### 1) Unique Interactions
get_uniques(natmi_omni, natmi_inbuilt, "Pair.Name") %>%
  rmarkdown::paged_table()# Unique to OmniPath

get_uniques(natmi_inbuilt, natmi_omni, "Pair.Name") %>%
  rmarkdown::paged_table() # Unique to Inbuilt
```

```{r natmi_ligands}
#### 2) Unique Ligands
get_uniques(natmi_omni, natmi_inbuilt, "Ligand.gene.symbol") %>%
  rmarkdown::paged_table() # Unique to OmniPath

get_uniques(natmi_inbuilt, natmi_omni, "Ligand.gene.symbol") %>%
  rmarkdown::paged_table() # Unique to Inbuilt
```

```{r natmi_receptors}
#### 3) Unique Receptors
get_uniques(natmi_omni, natmi_inbuilt, "Receptor.gene.symbol") %>%
  rmarkdown::paged_table() # Unique to OmniPath

get_uniques(natmi_inbuilt, natmi_omni, "Receptor.gene.symbol") %>%
  rmarkdown::paged_table() # Unique to Inbuilt
```
